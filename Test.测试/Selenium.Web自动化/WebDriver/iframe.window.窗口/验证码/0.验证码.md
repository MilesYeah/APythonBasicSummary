# 验证码

很多系统为了防止坏人，会增加各样形式的验证码，做测试最头痛的莫过于验证码的处理，验证码的处理一般分为三种方法
1. 开发给我们设置一个万能的验证码；
2. 开发将验证码给屏蔽掉；
3. 自己识别图片的上的千奇百怪的图片，但是这样的方法识别成功率不是特别的高，而且也不是对所有的都可以识别，只是识别一些简单的验证码；
4. 可以调用其他的服务商的验证码识别的接口，例如阿里云的云市场找到一家验证码识别的接口


## Js 破解关键的参数

这类方法的门槛就比较高了，通过断点调试 Js，逆向分析滑动后提交的参数的生成逻辑完成参数的生成，之后构造请求完成提交，当然这中间也是需要分析图片的缺口位置与模拟轨迹，不过没有使用到模拟所以速度快成功率高。

缺点是风险高，代码维护成本高，更新一个新版本就要重新分析而且逆向相关产品的代码是有一定的法律风险的，免费包吃住也不是开玩笑的，所以很多能够商业化的大佬们都闷声发大财不会到处张扬。


## 使用现有的服务

很多人就想把这一块的工作量与风险分出去，这就要使用到第三方的服务商了。

不过目前国内市场上的服务商并没有这类服务，目前咸鱼在使用的是一家俄罗斯的服务商 - 2Captcha

这个服务商提供的验证码服务有很多种，其中包含了我们比较关心的 GeeTest 。

每1000次的价格

下面咸鱼给大家简单介绍下如何使用服务。（不要问为啥收费，人家服务商也要吃饭，况且这个价格实在很便宜了）

首先，注册一个账号，官网是 http://2captcha.com/zh


完成注册之后会跳转到控制台界面，这里最重要的是获取到属于你的 API Key 。

好，拿到这个 API Key 之后就可以上手使用服务完成滑动的破解了。

通过参考官方的 API 文档，我们只需要构建 Get 请求就可以了。

第一个 Get 请求的组成是这样的：
```url
https://2captcha.com/in.php
?key= 上面获取的API KEY 
&method=geetest
&gt= 极验参数
&challenge= 极验参数
&api_server=api-na.geetest.com(可选)
&pageurl= 滑动验证码所在的网页地址
```

参数列表：
| 参数名     | 参数介绍                 |
| ---------- | ------------------------ |
| key        | API KEY                  |
| method     | 表示验证码类型           |
| gt         | 极验参数1                |
| challenge  | 极验参数2                |
| api_server | api-na.geetest.com(选填) |
| pageurl    | 滑动验证码所在的网页地址 |

这里解释下关于 gt 与 challenge 这两个参数的获取。

第一个请求中这两个参数其中 gt这个参数是固定的，找一个使用某验的网站就可以获取。例如：

challenge这个参数是有一个 Get 请求返回，你找到这个请求之后按照请求重新获取一次，如果是 XHR 的话也可以直接 reply XHR 。

提交完第一个请求之后，会返回类似下面的结果。
```
OK|2122988149 or as JSON {"status":1,"request":"2122988149"}
```
这里面的一串数字就是会话 ID。

有了这个会话 ID 之后我们就可以构建下一个请求了，这中间需要等待一些时间。
```url
https://2captcha.com/res.php
?key=API KEY
&action=get
&id=2122988149
```
参数列表：
| 参数名 | 参数介绍               |
| ------ | ---------------------- |
| key    | API KEY                |
| action | Get                    |
| id     | 上一个请求返回的会话ID |

这个请求返回的结果就是我们需要的加密参数了。
```json
{
      "challenge":"1a2b3456cd67890e12345fab678901c2de",
      "validate":"09fe8d7c6ba54f32e1dcb0a9fedc8765",
      "seccode":"12fe3d4c56789ba01f2e345d6789c012|jordan"
}
```
常见的几类验证码，已经全部介绍完了。

肯定有有人问像 google 家的 ReCaptcha 以及和他相似的 hCaptcha 的解决方案没有提到啊？

像以上两类验证码，刚刚提到的服务商也同样有提供接口打码，至于其他的解决方案，目前咸鱼还没有接触过，毕竟这两类验证码，咸鱼手动点击都没办法做到一次通过，目前也只能依赖服务商了。






# ref
* [咸鱼学Python](http://xianyucoder.cn/2020/01/08/%E6%80%BB%E7%BB%93%E5%87%A0%E7%A7%8D%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/)
* []()
* []()
* []()
* []()
* []()
* []()
