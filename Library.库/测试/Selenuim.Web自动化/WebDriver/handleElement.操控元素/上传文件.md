# 上传文件



## input标签上传文件

通过input标签实现的上传功能，可以将其看作是一个输入框，即通过send_keys()指定本地文件路径的方式实现文件上传。

```py
from selenium import webdriver
import os

driver = webdriver.Chrome()
file_path = "file:///" + os.path.abspath('upfile.html')
driver.get(file_path)
 
# 定位上传按钮的位置
driver.find_element_by_name('file').send_keys(os.path.abspath('upfile.txt'))
driver.quit()
```


## 非input标签上传文件
有时候，网站操作需要上传文件。

比如，著名的在线图片压缩网站： https://tinypng.com/

通常，网站页面上传文件的功能，是通过 type 属性 为 file 的 HTML input 元素实现的。

如下所示：
```HTML
<input type="file" multiple="multiple">
```
使用selenium自动化上传文件，我们只需要定位到该input元素，然后通过 send_keys 方法传入要上传的文件路径即可。

如下所示：
```PY
# 先定位到上传文件的 input 元素
ele = wd.find_element_by_css_selector('input[type=file]')

# 再调用 WebElement 对象的 send_keys 方法
ele.send_keys(r'h:\g02.png')
```
如果需要上传多个文件，可以多次调用send_keys，如下
```PY
ele = wd.find_element_by_css_selector('input[type=file]')
ele.send_keys(r'h:\g01.png')
ele.send_keys(r'h:\g02.png')
```
但是，有的网页上传，是没有 file 类型 的 input 元素的。

如果是Windows上的自动化，可以采用 Windows 平台专用的方法：


执行
```py
pip install pypiwin32
```

确保 pywin32 已经安装，然后参考如下示例代码
```py
# 找到点击上传的元素，点击
driver.find_element_by_css_selector('.dropzone').click()

sleep(2) # 等待上传选择文件对话框打开

# 直接发送键盘消息给 当前应用程序，
# 前提是浏览器必须是当前应用
import win32com.client
shell = win32com.client.Dispatch("WScript.Shell")

# 输入文件路径，最后的'\n'，表示回车确定，也可能时 '\r' 或者 '\r\n'
shell.Sendkeys(r"h:\a2.png" + '\n')
sleep(1)
```




## ref
* [Selenium系列（十一） - 针对两种上传文件方式的实现方案 _](https://www.cnblogs.com/poloyy/p/12607930.html)
* []()
* []()
* []()
* []()
* []()

